pipeline {
    agent {
        docker {
            image 'node:latest' // Specify the Docker image you want to use
            //args '-v /var/run/docker.sock:/var/run/docker.sock' // (Optional) Mount Docker socket to interact with the host's Docker daemon
        }
    }

    environment {
        AWS_CRED        = 'aws_jr10_wanda'
        S3BucketName    = credentials('s3_bucket_name')
    }

    stages {
        stage('Build') {
            steps {
                sh 'npm install' // Install dependencies
                sh 'npm run build' // Run npm build command
            }
        }
        stage('Install AWS CLI') {
            steps {
                sh 'npm install -g aws-cli' // Install AWS CLI in the Docker container
                sh 'which aws'
            }
        }
        stage('Upload S3 Bucket') {
            steps {
                withAWS(credentials: AWS_CRED, region: 'ap-southeast-2') {
                    sh '''
                        /usr/local/bin/aws s3 rm s3://$S3BucketName/ --recursive
                        /usr/local/bin/aws s3 sync ./out/ s3://$S3BucketName/
                    '''
                }
            }
        }
    }
}
