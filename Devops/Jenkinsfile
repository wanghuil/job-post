pipeline {
    agent {
        docker {
            image 'ubuntu:latest' // Use the Ubuntu image
            args '--privileged' // Optional: If you need elevated privileges in the container
        }
    }

    environment {
        AWS_CRED        = 'aws_jr10_wanda'
        S3BucketName    = credentials('s3_bucket_name')
    }

    stages {
        stage('Install Node.js and AWS CLI') {
            steps {
                sh 'apt update && apt install -y nodejs npm' // Install Node.js and npm
                sh 'npm install -g aws-cli' // Install AWS CLI using npm
            }
        }

        stage('Build') {
            steps {
                sh 'npm install' // Install dependencies
                sh 'npm run build' // Run npm build command
            }
        }

        stage('Upload S3 Bucket') {
            steps {
                withAWS(credentials: AWS_CRED, region: 'ap-southeast-2') {
                    sh '''
                        aws s3 rm s3://$S3BucketName/ --recursive
                        aws s3 sync ./out/ s3://$S3BucketName/
                    '''
                }
            }
        }
    }
}
